<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8">
        <title>Thoughts</title>
        <meta property="og:title" content="Thoughts">
        <link rel="stylesheet" href="/css/style.css">
    </head>
    <body>
        <header>
            <nav>
                <ul>
                    <li><a class="symbol testflight" target="_blank" href="https://testflight.apple.com/join/FgskNeh0">TestFlight</a></li>
                    <li><a class="symbol github" target="_blank" href="https://github.com/inseven/thoughts">GitHub</a></li>
                </ul>
            </nav>
            <div class="center">
                <div class="window">
                    <div id="title" class="title">Friday 3 May 2024 at 11:11:15</div>
                    <div id="container" class="container"></div>
                </div>
            </div>
            <div id="source">
                {{ content }}
            </div>
        </header>
        <div class="details">

            <a id="release-notes"></a>
            {% include fetch_page.html page_path='release-notes/index.markdown' %}

            <a id="privacy-policy"></a>
            {% include fetch_page.html page_path='privacy-policy/index.markdown' %}

            <a id="license"></a>
            {% include fetch_page.html page_path='license/index.markdown' %}

            <footer>
                <p>Copyright &copy; 2024 <a href="https://jbmorley.co.uk">Jason Morley</a></p>
            </footer>
        </div>

        <script>

            async function typeChildren(from, to) {
                const delay = ms => new Promise(res => setTimeout(res, ms));
                const isWhitespaceString = str => !/\S/.test(str)
                for (const child of from.childNodes) {

                    console.log(child);
                    console.log(child.nodeType)

                    if (child.nodeType == Node.TEXT_NODE) {
                        const text = child.nodeValue
                        if (isWhitespaceString(text)) {
                            to.innerHTML += text
                        } else {
                            for (const c of text) {
                                await delay(60);
                                console.log(c);
                                to.innerHTML += c;
                            }
                        }
                    } else {
                        // Create a placeholder destination node to type in.
                        var placeholder = document.createElement("span");
                        to.appendChild(placeholder);

                        // Type the contents.
                        await typeChildren(child, placeholder);

                        // Create the actual node and replace the placeholder node.
                        placeholder.replaceWith(child.cloneNode(true));
                    }
                }
            }

            function setTitle() {

                let title = document.getElementById("title");

                var now = new Date();
                const weekdays = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
                let weekday = weekdays[now.getDay()];

                const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
                let month = months[now.getMonth()];

                var dd = now.getDate();
                var yyyy = now.getFullYear();
                var hours = now.getHours();
                var minutes = now.getMinutes().toString().padStart(2, '0');
                var seconds = now.getSeconds().toString().padStart(2, '0');

                title.innerHTML = weekday + ' ' + dd + ' ' + month + ' ' + yyyy + ' at ' + hours + ':' + minutes + ':' + seconds;
            }

            async function update() {
                let container = document.getElementById("source");
                let destination = document.getElementById("container");
                typeChildren(container, destination);
            }

            setTitle();
            update();

        </script>
    </body>
</html>